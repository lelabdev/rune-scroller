# Rune Scroller - Library Guide for LLMs

Lightweight scroll animation library for Svelte 5 using IntersectionObserver and CSS animations (GPU-accelerated).

## Quick Start

```svelte
<script>
  import runeScroller from 'rune-scroller';
</script>

<div use:runeScroller={{ animation: 'fade-in-up' }}>
  Content animates on scroll
</div>
```

**Important:** CSS is automatically included. No manual CSS import needed.

## Core Architecture

**Sentinel-Based Triggering:** Creates invisible 1px sentinel below element. When sentinel enters viewport, animation triggers. Sentinel repositions on resize (ResizeObserver). More accurate than observing element directly.

**14 Animations:** Fade (5), Zoom (5), Special (4: flip, flip-x, slide-rotate, bounce-in). All use 300px translation and respect `prefers-reduced-motion`.

## API Reference

### runeScroller Action

```typescript
{
  animation?: AnimationType,   // Default: 'fade-in'
  duration?: number,           // Default: 800ms
  repeat?: boolean,            // Default: false
  debug?: boolean,             // Default: false
  offset?: number,             // Default: 0px (negative = trigger earlier)
  onVisible?: (el) => void,
  sentinelColor?: string,      // Default: '#00e0ff'
  sentinelId?: string
}
```

### Composables

```svelte
<script>
  import { useIntersection, useIntersectionOnce } from 'rune-scroller';
  const intersection = useIntersectionOnce({ threshold: 0.5 });
</script>

<div bind:this={intersection.element}>
  {#if intersection.isVisible}Content visible!{/if}
</div>
```

### Utility

```javascript
import { calculateRootMargin } from 'rune-scroller';
```

## File Structure

```
lib/src/lib/
├── index.js              # Auto-imports CSS, exports all APIs
├── runeScroller.js       # Main action (sentinel-based)
├── useIntersection.svelte.js  # Composables (Svelte 5 $effect)
├── animations.js         # Animation types, calculateRootMargin()
├── animations.css        # CSS keyframes with custom properties
├── dom-utils.js          # setCSSVariables(), createSentinel()
├── observer-utils.js     # IntersectionObserver setup
└── types.js             # JSDoc type definitions

tests/                    # Excluded from npm
├── *.test.js            # 121 tests
├── __mocks__/           # IntersectionObserver, Svelte runes
└── __test-helpers__/    # DOM helpers

dist/                     # Built output (svelte-package)
```

## Development

```bash
cd lib
bun test              # All tests
bun test --watch      # Watch mode
bun run build         # Build
bun run check         # Type check
bun run lint          # Format + lint
npm publish          # Publish
```

## Code Style

- Tabs, single quotes, 100 char line width
- JSDoc annotations (no TypeScript)
- Svelte 5 runes only ($state, $effect, $props())
- Pure CSS, zero dependencies

## Implementation Details

**CSS Custom Properties:** `--duration`, `--delay`, `--tx`, `--ty`, `--scale`, `--rx`, `--ry`, `--rotate`

**Performance:** Native IntersectionObserver, CSS transforms (GPU), proper cleanup

**SSR:** Actions check `typeof window === 'undefined'`, return no-op during SSR

**Svelte 5 Runes:** $state() for state, $effect() for cleanup, $props() for props

## Adding Animations

1. Add to `VALID_ANIMATIONS` in `src/lib/animations.js`
2. Add CSS rule to `src/lib/animations.css`:

```css
[data-animation='my-anim'] { --tx: 100px; --scale: 0.5; }
[data-animation='my-anim'].is-visible { transform: translate(0) scale(1); }
```

3. Run `bun test && cd .. && bun run dev`

## Testing

Tests import from `../src/lib/` (source, not dist/). Uses Bun test + happy-dom. Test files excluded from npm.

## Current Metrics (v2.2.0)

- Package: 12.4KB (compressed), 40.3KB (unpacked)
- Tests: 121/121 (100%)
- Verify with: `npm pack` and `bun test`

## Links

- GitHub: https://github.com/ludoloops/rune-scroller
- npm: https://www.npmjs.com/package/rune-scroller
- Creator: ludoloops @ LeLab.dev

**Package Manager:** Bun (project-specific)
